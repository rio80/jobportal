steps:
- name: 'gcr.io/cloud-builders/gcloud'
  args:
    - .env.testing
    - .env
- name: 'docker/compose:1.4.2'
  args:
    - run
    - app
    - composer
    - install
    - --optimize-autoloader
    - --no-interaction
    - --no-ansi
    - --no-progress
    - --no-scripts
    - --prefer-dist
- name: 'docker/compose:1.4.2'
  args:
    - run
    - app
    - vendor/bin/phpunit
    - --no-coverage
- name: 'gcr.io/cloud-builders/gcloud'
  args:
    - ${_APP_YAML_CONFIG}
    - app.yaml
- name: 'gcr.io/cloud-builders/gcloud'
  args:
    - app
    - deploy
    - --no-promote
timeout: '1600s'